# 静态博客生成器

Node.js 除了可以编写服务器端应用程序，也可以用来编写一些命令行工具，
比如比较流行的前端自动化构建工具 gulp 就是使用 Node.js 编写的。

## 第三方模块

- commander
  + 解析命令行参数
- Express
  + Web 框架
- marked
  + 解析转换 Markdown 文档
- jade
  + 模板引擎
- rd
  + 遍历目录下的所有文件，包括子目录
- fsp
  + promise 风格的 fs 模块
- open
  + 使用系统程序打开指定文件或网址
- moment
  + 解析、格式化日期时间

## 命令格式

在编写命令行工具的时候，我们首先要定义命令的使用方法，比如：

```bash
$ myblog create 表示创建一个空的博客
$ myblog build  表示生成整站静态 HTML 页面
```

### 常见命令格式

一条命令一般包含以下部分：

```bash
$ command [option] [arguments]
```

各部分的含义如下：

- command: 命令名称，比如 `node`
- options: `--单词` 或 `-单字` ，比如 `--help` 和 `-h`
- arguments: 参数，有时选项也带参数

在查看命令帮助时，会出现 `<>`、`<>`、`|` 等符号，它们的含义如下：

- `[]`: 表示可选的
- `<>`: 表示可变选项，一般是多选一，而且必须要选其一
- `x|y|z`: 多选一，如果加上 `[]` ，则可不选
- `-abc`: 多选，如果加上 `[]` ，则可不选

比如，NPM 命令的使用方法描述如下：

```
Usage: npm <command>
```

其中，<command> 表示可变选项，可以为 list、install、config 等，比如：

```bash
$ npm list
```

以上是大多数命令行工具遵循的语法格式。

## 定义静态博客命令格式

我们要实现的静态博客生成工具包含以下功能：

- 创建一个空的博客
- 文章使用 Markdown 格式编写
- 本地实时预览
- 生成整站静态 HTML

根据以上描述，我们先来定义这个命令行工具的使用方法，如下表所示：

|                 格式                 |                             描述                             |
|--------------------------------------|--------------------------------------------------------------|
| myblog create [dir]                  | 创建一个空的博客，dir 为博客所在目录（可选，默认为当前目录） |
| myblog preview [dir]                 | 实时预览，dir 为博客所在目录（可选，默认为当前）             |
| myblog build [dir] [--output target] | 生成整站静态 HTML，dir 为博客所在目录（可选，默认为当前目录，target 为生成的静态 HTML 存放目录） |

---

## 编写命令行工具

```
#!/usr/bin/env node
```

第一行 `#!/usr/bin/env node` 表示用于指定文件使用哪个解释器来执行。
在 Linux Shell 环境下，文件具有执行权限时，可以直接通过 `./xxx` 来执行。

## 实时预览

一个静态博客工具应该包含以下这些功能：

- 渲染文章内容页面和文章列表页面
- 修改模板实时预览
- 创建基本的博客模板
